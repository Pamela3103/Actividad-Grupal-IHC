<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EasyMeal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&family=Salsa&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/diario/styles.css" />

  <style>
    .sidebar .menu button:hover {
      background-color: #ff38e4 !important; /* Color rosa fucsia con !important para asegurar que se aplique */
      border-radius: 8px !important;      /* Esquinas redondeadas */
    }
  </style>

</head>
<body>
  <div id="modal">
    <div id="modal-content">
      <h3>Nueva receta</h3>
      <form id="form-receta" enctype="multipart/form-data">
        <div class="form-columns">
          <div class="col col1">
            <label for="imagen">Foto de la receta:</label>
            <input type="file" id="imagen" accept="image/*">
            <img id="preview" src="#" alt="Vista previa" style="display: none; width: 100%; border-radius: 10px; margin-top: 10px;" />
            <label for="nivel">Nivel de la receta:</label>
            <select id="nivel" required>
              <option disabled selected hidden>Selecciona un nivel</option>
              <option value="F√°cil">F√°cil</option>
              <option value="Intermedio">Intermedio</option>
              <option value="Master Chef">Master Chef</option>
            </select>
          </div>

          <div class="col col2">
            <label for="titulo">T√≠tulo de la receta:</label>
            <textarea id="titulo" placeholder="T√≠tulo de la receta"  required></textarea>
            <label for="nota">Nota o comentario:</label>
            <textarea id="nota" placeholder="Nota o comentario" rows="4" required></textarea>
          </div>

          <div class="col col3 opciones">
            <label for="resultado">Resultado:</label>
            <select id="resultado" required>
              <option disabled selected hidden>Selecciona una opci√≥n</option>
              <option value="Me encant√≥">Me encant√≥</option>
              <option value="Qued√≥ bien">Qued√≥ bien</option>
              <option value="Aceptable">Aceptable</option>
              <option value="No me sali√≥">No me sali√≥</option>
            </select>

            <label for="dificultad">Dificultad:</label>
            <select id="dificultad" required>
              <option disabled selected hidden>Selecciona una opci√≥n</option>
              <option value="S√∫per f√°cil">S√∫per f√°cil</option>
              <option value="F√°cil de seguir">F√°cil de seguir</option>
              <option value="Intermedia">Intermedia</option>
              <option value="Un poco dif√≠cil">Un poco dif√≠cil</option>
              <option value="Muy dif√≠cil">Muy dif√≠cil</option>
            </select>

            <label for="presentacion">Presentaci√≥n:</label>
            <select id="presentacion" required>
              <option disabled selected hidden>Selecciona una opci√≥n</option>
              <option value="Muy bonita">Muy bonita</option>
              <option value="Bonita">Bonita</option>
              <option value="Normal">Normal</option>
              <option value="Podr√≠a mejorar">Podr√≠a mejorar</option>
              <option value="Fea">Fea</option>
            </select>

            <label for="tiempo">Tiempo:</label>
            <select id="tiempo" required>
              <option disabled selected hidden>Selecciona una opci√≥n</option>
              <option value="R√°pido">R√°pido</option>
              <option value="En el tiempo previsto">En el tiempo previsto</option>
              <option value="Muy demorado">Muy demorado</option>
            </select>
          </div>
        </div>

        <div style="text-align: right; margin-top: 20px;">
          <button type="button" class="cancelar" onclick="cerrarModal()">Cancelar</button>
          <button type="submit" class="guardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="confirm-modal" class="confirm-modal">
    <div class="confirm-content">
      <p>¬øEst√°s seguro de que quieres salir? Se perder√°n los cambios.</p>
      <div class="confirm-buttons">
        <button id="confirm-yes">S√≠, salir</button>
        <button id="confirm-no">Cancelar</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="menu">
        <a href="Menu.html">
         <button><img src="assets/diario/icons/Home.png" alt="Ir a p√°gina"></button>
        </a>
        <a href="recomendaciones.html">
          <button><img src="assets/diario/icons/Comida r√°pida.png" alt=""></button>
        </a>
        <a href="favoritos.html">
          <button><img src="assets/diario/icons/Favoritos.png" alt=""></button>
        </a>
        <a href="diario.html">
          <button><img src="assets/diario/icons/Libreto.png" alt=""></button>
        </a>
        <a href="index.html"></a>
          <button><img src="assets/diario/icons/Exit.jpg" alt=""></button>
        </a>
      </div>
    </div>

    <div class="content">
      <div class="logo">
        <img src="assets/diario/icons/easymeal_logo.png" alt="EasyMeal Logo">
        <span class="easymeal-title">EasyMeal</span>
        <div class="header-right">
          <button><img src="assets/diario/icons/Notificaci√≥n.png" alt="Notificaci√≥n"></button>
          <a href="test.html" class="icono-link">
            <img src="assets/recomendaciones/icons/User.png" alt="Ir a mi perfil de Usuario">
          </a>
        </div>
      </div>
      <div class="header diario-header">
        <div class="title">
          <span class="main-title">MI DIARIO DE COCINA</span>
          <button class="add-button">+ A√±adir</button>
        </div>
      </div>

      <div class="filters">
        <img src="assets/diario/icons/Filtros.png" alt="Icono filtro">
        <select id="filtro-resultado">
          <option disabled selected hidden>Resultado</option>
          <option value="Me encant√≥">Me encant√≥</option>
          <option value="Qued√≥ bien">Qued√≥ bien</option>
          <option value="Aceptable">Aceptable</option>
          <option value="No me sali√≥">No me sali√≥</option>
        </select>
        <select id="filtro-dificultad">
          <option disabled selected hidden>Dificultad</option>
          <option value="S√∫per f√°cil">S√∫per f√°cil</option>
          <option value="F√°cil de seguir">F√°cil de seguir</option>
          <option value="Intermedia">Intermedia</option>
          <option value="Un poco dif√≠cil">Un poco dif√≠cil</option>
          <option value="Muy dif√≠cil">Muy dif√≠cil</option>
        </select>
        <select id="filtro-presentacion">
          <option disabled selected hidden>Presentaci√≥n</option>
          <option value="Muy bonita">Muy bonita</option>
          <option value="Bonita">Bonita</option>
          <option value="Normal">Normal</option>
          <option value="Podr√≠a mejorar">Podr√≠a mejorar</option>
        </select>
        <select id="filtro-tiempo">
          <option disabled selected hidden>Tiempo </option>
          <option value="R√°pido">R√°pido</option>
          <option value="Regular">Regular</option>
          <option value="Muy demorado">Muy demorado</option>
        </select>
        <button id="quitar-filtros"><img src="assets/diario/icons/Eliminar_filtro.png" alt=""> Quitar filtros</button>
      </div>

      <style>
      .recipe-card {
        display: flex;
        align-items: flex-start;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        padding: 16px;
        margin-bottom: 20px;
        max-width: 800px;
        min-width: 500px;
      }
      .recipe-card img {
        width: 140px;
        height: 140px;
        object-fit: cover;
        border-radius: 12px;
        margin-right: 28px;
      }
      .recipe-card .recipe-content {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        flex: 1;
      }
      .recipe-card .title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 8px;
      }
      .recipe-card .nota {
        font-size: 1rem;
        color: #666;
        margin-bottom: 10px;
        margin-top: 2px;
      }
      .recipe-card .tags {
        display: flex;
        gap: 8px;
      }
      .recipe-card .tags span {
        background: #e6f7e6;
        color: #2e7d32;
        border-radius: 8px;
        padding: 4px 10px;
        font-size: 0.9rem;
      }
      .recipe-card .badge {
        margin-bottom: 8px;
        background: #e1ea2e;
        color: #020202;
        font-size: 0.9rem;
        font-weight: 500;
        border-radius: 6px;
        padding: 2px 10px;
        display: inline-block;
      }
      .recipe-grid {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      </style>
      <div class="recipe-grid">
        <div class="recipe-card">
          <img src="assets/diario/cheesecake_fresa.png" alt="Cheesecake de Fresa"/>
          <div class="recipe-content">
            <div class="badge">F√°cil</div>
            <div class="title">CHEESECAKE DE FRESA</div>
            <div class="nota">NOTA: Usar menos az√∫car en la base y a√±adir ralladura de lim√≥n al relleno.</div>
            <div class="tags">
              <span>ME ENCANT√ì</span><span>F√ÅCIL DE SEGUIR</span> <span>BONITA</span> <span>REGULAR</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="editar-btn">‚úèÔ∏è</button>
            <button class="eliminar-btn">üóëÔ∏è</button>
          </div>
        </div>
        <div class="recipe-card">
          <img src="assets/diario/galletas.png" alt="Galletas con Chispas"/>
          <div class="recipe-content">
            <div class="badge">F√°cil</div>
            <div class="title">GALLETAS CON CHISPAS</div>
            <div class="nota">NOTA: Probar con chispas oscuras y un poco de sal marina encima.</div>
            <div class="tags">
              <span>QUED√ì BIEN</span><span>S√öPER F√ÅCIL</span><span>MUY BONITA</span><span>R√ÅPIDO</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="editar-btn">‚úèÔ∏è</button>
            <button class="eliminar-btn">üóëÔ∏è</button>
          </div>
        </div>
        <div class="recipe-card">
          <img src="assets/diario/yogurt_granola.jpg" alt="Yogurt con Granola"/>
          <div class="recipe-content">
            <div class="badge">F√°cil</div>
            <div class="title">YOGURT CON GRANOLA</div>
            <div class="nota">NOTA: Tostar la granola con canela para m√°s sabor y textura.</div>
            <div class="tags">
              <span>ME ENCANT√ì</span><span>S√öPER F√ÅCIL</span><span>NORMAL</span><span>R√ÅPIDO</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="editar-btn">‚úèÔ∏è</button>
            <button class="eliminar-btn">üóëÔ∏è</button>
          </div>
        </div>
        <div class="recipe-card">
          <img src="assets/diario/batidos_platano.jpg" alt="Batido de Platano"/>
          <div class="recipe-content">
            <div class="badge">F√°cil</div>
            <div class="title">BATIDO DE PLATANO</div>
            <div class="nota">NOTA: Agregar hielo y unas gotas de lim√≥n para hacerlo m√°s fresco.</div>
            <div class="tags">
              <span>ACEPTABLE</span><span>S√öPER F√ÅCIL</span><span>NORMAL</span><span>R√ÅPIDO</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="editar-btn">‚úèÔ∏è</button>
            <button class="eliminar-btn">üóëÔ∏è</button>
          </div>
        </div>
      </div>
      <div id="formulario">
        <h3>Agregar Receta</h3>
        <form>
          <input type="text" placeholder="T√≠tulo de la receta" required>
          <textarea placeholder="Nota o comentario" rows="4" required></textarea>
          <button type="submit">Guardar</button>
          <button type="button" onclick="document.getElementById('formulario').style.display='none'">Cancelar</button>
        </form>
      </div>
      <div id="notificacion" style="
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 12px 18px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        display: none;
        z-index: 1000;
        font-family: 'Poppins', sans-serif;
        font-size: 14px;
      ">
        ‚úì Registro a√±adido exitosamente
      </div>

      <script>
        let recetaEditando = null;
        const modal = document.getElementById("modal");
        const botonAbrir = document.querySelector(".add-button");
        const formulario = document.querySelector("#modal-content form");

        botonAbrir.addEventListener("click", () => {
          formulario.reset();
          const preview = document.getElementById("preview");
          if (preview) preview.style.display = "none";
          modal.style.display = "flex";
        });

        function cerrarModal() {
          document.getElementById("confirm-modal").style.display = "flex";
        }

        document.getElementById("confirm-yes").addEventListener("click", () => {
          document.getElementById("modal").style.display = "none";
          document.getElementById("confirm-modal").style.display = "none";
        });

        document.getElementById("confirm-no").addEventListener("click", () => {
          document.getElementById("confirm-modal").style.display = "none";
        });

        window.addEventListener("click", (e) => {
          if (e.target === modal) {
            cerrarModal();
          }
        });

        const inputImagen = document.getElementById("imagen");
        const preview = document.getElementById("preview");

        inputImagen.addEventListener("change", () => {
          const file = inputImagen.files[0];
          if (file) {
            preview.src = URL.createObjectURL(file);
            preview.style.display = "block";
          }
        });

        document.getElementById("form-receta").addEventListener("submit", function (e) {
          e.preventDefault();
          const titulo = document.getElementById("titulo").value;
          const nota = document.getElementById("nota").value;
          const nivel = document.getElementById("nivel").value;
          const resultado = document.getElementById("resultado").value;
          const dificultad = document.getElementById("dificultad").value;
          const presentacion = document.getElementById("presentacion").value;
          const tiempo = document.getElementById("tiempo").value;
          const imagenInput = document.getElementById("imagen");
          const imagenArchivo = imagenInput.files[0];

          if (
            resultado === "Selecciona una opci√≥n" ||
            dificultad === "Selecciona una opci√≥n" ||
            presentacion === "Selecciona una opci√≥n" ||
            tiempo === "Selecciona una opci√≥n" ||
            nivel === "Selecciona un nivel"
          ) {
            alert("Por favor, completa todos los campos antes de guardar.");
            return;
          }

          const reader = new FileReader();

          reader.onload = function (event) {
            if (recetaEditando) {
              recetaEditando.querySelector("img").src = event.target.result;
              recetaEditando.querySelector(".badge").textContent = nivel;
              recetaEditando.querySelector(".title").textContent = titulo.toUpperCase();
              recetaEditando.querySelector(".nota").textContent = "NOTA: " + nota;
              recetaEditando.querySelector(".tags").innerHTML = `
                <span>${resultado.toUpperCase()}</span>
                <span>${dificultad.toUpperCase()}</span>
                <span>${presentacion.toUpperCase()}</span>
                <span>${tiempo.toUpperCase()}</span>
              `;
              mostrarNotificacion();
              recetaEditando = null;
            } else {
              const recetaHTML = `
                <div class="recipe-card">
                  <img src="${event.target.result}" alt="${titulo}" />
                  <div class="recipe-content">
                    <div class="badge">${nivel}</div>
                    <div class="title">${titulo.toUpperCase()}</div>
                    <div class="nota">NOTA: ${nota}</div>
                    <div class="tags">
                      <span>${resultado.toUpperCase()}</span>
                      <span>${dificultad.toUpperCase()}</span>
                      <span>${presentacion.toUpperCase()}</span>
                      <span>${tiempo.toUpperCase()}</span>
                    </div>
                  </div>
                  <div class="card-actions">
                    <button class="editar-btn">‚úèÔ∏è</button>
                    <button class="eliminar-btn">üóëÔ∏è</button>
                  </div>
                </div>
              `;
              const contenedor = document.querySelector(".recipe-grid");
              contenedor.insertAdjacentHTML("afterbegin", recetaHTML);
              mostrarNotificacion();
            }

            modal.style.display = "none";
            document.getElementById("form-receta").reset();
            const preview = document.getElementById("preview");
            if (preview) preview.style.display = "none";
          };

          if (imagenArchivo || recetaEditando) {
            if (imagenArchivo) {
              reader.readAsDataURL(imagenArchivo);
            } else {
              const imgExistente = recetaEditando.querySelector("img").src;
              reader.onload({
                target: { result: imgExistente }
              });
            }
          } else {
            alert("Por favor selecciona una imagen");
          }
        });

        function mostrarNotificacion() {
          const notif = document.getElementById("notificacion");
          notif.style.display = "block";
          setTimeout(() => {
            notif.style.display = "none";
          }, 3000);
        }

        function filtrarPorUnSoloFiltro(idFiltro) {
          const valorSeleccionado = document.getElementById(idFiltro).value.toUpperCase();
          const tarjetas = document.querySelectorAll('.recipe-card');
          tarjetas.forEach(card => {
            const tags = Array.from(card.querySelectorAll('.tags span')).map(tag => tag.textContent.toUpperCase());
            const coincide = tags.includes(valorSeleccionado);
            card.style.display = coincide ? 'flex' : 'none';
          });
        }

        document.getElementById("filtro-resultado").addEventListener("change", () => {
          filtrarPorUnSoloFiltro("filtro-resultado");
        });
        document.getElementById("filtro-dificultad").addEventListener("change", () => {
          filtrarPorUnSoloFiltro("filtro-dificultad");
        });
        document.getElementById("filtro-presentacion").addEventListener("change", () => {
          filtrarPorUnSoloFiltro("filtro-presentacion");
        });
        document.getElementById("filtro-tiempo").addEventListener("change", () => {
          filtrarPorUnSoloFiltro("filtro-tiempo");
        });

        document.getElementById("quitar-filtros").addEventListener("click", () => {
          document.querySelectorAll("select").forEach(select => {
            select.selectedIndex = 0;
          });
          document.querySelectorAll('.recipe-card').forEach(card => {
            card.style.display = 'flex';
          });
        });

        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("eliminar-btn")) {
            const card = e.target.closest(".recipe-card");
            if (confirm("¬øDeseas eliminar este registro?")) {
              card.remove();
            }
          }
        });

        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("editar-btn")) {
            const card = e.target.closest(".recipe-card");
            recetaEditando = card;
            const titulo = card.querySelector(".title").textContent;
            const nota = card.querySelector(".nota").textContent.replace("NOTA: ", "");
            const nivel = card.querySelector(".badge").textContent;
            const etiquetas = Array.from(card.querySelectorAll(".tags span")).map(span => span.textContent);
            const imagenSrc = card.querySelector("img").src;
            document.getElementById("titulo").value = titulo;
            document.getElementById("nota").value = nota;
            document.getElementById("nivel").value = nivel;

            function asignarValorNormalizado(idSelect, valorTag) {
              const select = document.getElementById(idSelect);
              for (const option of select.options) {
                if (option.value.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") ===
                    valorTag.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "")) {
                  select.value = option.value;
                  break;
                }
              }
            }

            asignarValorNormalizado("resultado", etiquetas[0]);
            asignarValorNormalizado("dificultad", etiquetas[1]);
            asignarValorNormalizado("presentacion", etiquetas[2]);
            asignarValorNormalizado("tiempo", etiquetas[3]);

            const preview = document.getElementById("preview");
            preview.src = imagenSrc;
            preview.style.display = "block";
            modal.style.display = "flex";
          }
        });
      </script>
</body>
</html>